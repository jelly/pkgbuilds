Index: branches/7.1/provider/libserver/ECDatabaseMySQL.cpp
===================================================================
diff -u -N -r44935 -r45010
--- branches/7.1/provider/libserver/ECDatabaseMySQL.cpp	(.../ECDatabaseMySQL.cpp)	(revision 44935)
+++ branches/7.1/provider/libserver/ECDatabaseMySQL.cpp	(.../ECDatabaseMySQL.cpp)	(revision 45010)
@@ -594,10 +594,17 @@
 	if (m_ulMaxAllowedPacket < MAX_ALLOWED_PACKET)
 		m_lpLogger->Log(EC_LOGLEVEL_WARNING, "max_allowed_packet is smaller than 16M (%d). You are advised to increase this value by adding max_allowed_packet=16M in the [mysqld] section of my.cnf.", m_ulMaxAllowedPacket);
 
-	if (m_lpMySQL.server_version && m_lpMySQL.server_version[0] >= '5') {
-		// this option was introduced in mysql 5.0, so let's not even try on 4.1 servers
-		strQuery = "SET SESSION sql_mode = 'STRICT_ALL_TABLES'";
-		Query(strQuery); // ignore error
+	if (m_lpMySQL.server_version) {
+		// m_lpMySQL.server_version is a C type string (char*) containing something like "5.5.37-0+wheezy1" (MySQL),
+		// "5.5.37-MariaDB-1~wheezy-log" or "10.0.11-MariaDB=1~wheezy-log" (MariaDB)
+		// The following code may look funny, but it is correct, see http://www.cplusplus.com/reference/cstdlib/strtol/
+		long int majorversion = strtol(m_lpMySQL.server_version, NULL, 10);
+		// Check for over/underflow and version.
+		if ((errno != ERANGE) && (majorversion >= 5)) {
+			// this option was introduced in mysql 5.0, so let's not even try on 4.1 servers
+			strQuery = "SET SESSION sql_mode = 'STRICT_ALL_TABLES,NO_UNSIGNED_SUBTRACTION'";
+			Query(strQuery); // ignore error
+		}
 	}
 
 exit:
